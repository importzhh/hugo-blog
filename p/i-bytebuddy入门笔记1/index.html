<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ç®€ä»‹ ByteBuddyæ”¯æŒæ£€æµ‹å’Œä¿®æ”¹ç°æœ‰Javaå­—èŠ‚ç çš„å·¥å…·ã€‚ æ·»åŠ æ–°çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡ åˆ é™¤ç°æœ‰æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®Ãä¾‹å˜é‡ ä¿®æ”¹å®ä¾‹å˜é‡"><title>I: ByteBuddyå…¥é—¨ç¬”è®°1</title><link rel=canonical href=https://blog.importzhh.me/p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/><link rel=stylesheet href=/scss/style.min.0d8902b26558cddb5286ea49f2a7aadd5761ed898547e29e5ab572d8c0619ba6.css><meta property="og:title" content="I: ByteBuddyå…¥é—¨ç¬”è®°1"><meta property="og:description" content="ç®€ä»‹ ByteBuddyæ”¯æŒæ£€æµ‹å’Œä¿®æ”¹ç°æœ‰Javaå­—èŠ‚ç çš„å·¥å…·ã€‚ æ·»åŠ æ–°çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡ åˆ é™¤ç°æœ‰æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®Ãä¾‹å˜é‡ ä¿®æ”¹å®ä¾‹å˜é‡"><meta property="og:url" content="https://blog.importzhh.me/p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/"><meta property="og:site_name" content="importzhhçš„å°ç ´ç«™"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="bytebuddy"><meta property="article:published_time" content="2023-08-06T17:06:29+08:00"><meta property="article:modified_time" content="2023-08-06T17:06:29+08:00"><meta name=twitter:title content="I: ByteBuddyå…¥é—¨ç¬”è®°1"><meta name=twitter:description content="ç®€ä»‹ ByteBuddyæ”¯æŒæ£€æµ‹å’Œä¿®æ”¹ç°æœ‰Javaå­—èŠ‚ç çš„å·¥å…·ã€‚ æ·»åŠ æ–°çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡ åˆ é™¤ç°æœ‰æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®Ãä¾‹å˜é‡ ä¿®æ”¹å®ä¾‹å˜é‡"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huce6e906a97de2553354850eae15a0392_8624_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>importzhhçš„å°ç ´ç«™</a></h1><h2 class=site-description>å®äº‹æ±‚æ˜¯ æ€å±æ€é€€æ€å˜</h2></div></header><ol class=social-menu><li><a href=https://github.com/importzhh target=_blank title=GitHub rel=me><svg width="800" height="800" viewBox="-1.65 0 259.3 259.3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"><g><path fill="#9edcf2" d="M200.9 199.8c0 13.9-32.2 25.1-71.9 25.1-39.7.0-71.9-11.3-71.9-25.1.0-13.9 32.2-25.1 71.9-25.1C168.7 174.7 200.9 185.9 200.9 199.8zm0 0"/><g><defs><path id="SVGID_1_" d="M98.1 244.8c1.6 7.5 5.5 11.9 9.4 14.5h41.1c5-3.4 10.1-9.8 10.1-21.8v-31s.6-7.7 7.7-10.2c0 0 4.1-2.9-.3-4.5.0.0-19.5-1.6-19.5 14.4v23.6s.8 8.7-3.8 12.3v-29.2s.3-9.3 5.1-12.8c0 0 3.2-5.7-3.8-4.2.0.0-13.4 1.9-14 17.6l-.3 30h-3.2l-.3-30c-.6-15.6-14-17.6-14-17.6-7-1.6-3.8 4.2-3.8 4.2 4.8 3.5 5.1 12.8 5.1 12.8v29.5c-4.6-3.3-3.8-12.6-3.8-12.6v-23.6c0-16-19.5-14.4-19.5-14.4-4.5 1.6-.3 4.5-.3 4.5 7 2.6 7.7 10.2 7.7 10.2v21.7L98.1 244.8z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><path clip-path="url(#SVGID_2_)" fill="#7dbce7" d="M200.9 199.8c0 13.9-32.2 25.1-71.9 25.1-39.7.0-71.9-11.3-71.9-25.1.0-13.9 32.2-25.1 71.9-25.1C168.7 174.7 200.9 185.9 200.9 199.8zm0 0"/></g><path fill="#9edcf2" d="M46.9 125.9l-2.1 7.2s-.5 2.6 1.9 3.1c2.6-.1 2.4-2.5 2.2-3.2L46.9 125.9zm0 0"/><path fill="#010101" d="M255.8 95.6l.2-.9c-21.1-4.2-42.7-4.3-55.8-3.7 2.1-7.7 2.8-16.7 2.8-26.6.0-14.3-5.4-25.7-14-34.3 1.5-4.9 3.5-15.8-2-29.7.0.0-9.8-3.1-32.1 11.8-8.7-2.2-18-3.3-27.3-3.3-10.2.0-20.5 1.3-30.2 3.9C74.4-2.9 64.3.3 64.3.3c-6.6 16.5-2.5 28.8-1.3 31.8-7.8 8.4-12.5 19.1-12.5 32.2.0 9.9 1.1 18.8 3.9 26.5-13.2-.5-34-.3-54.4 3.8l.2.9c20.4-4.1 41.4-4.2 54.5-3.7.6 1.6 1.3 3.2 2 4.7-13 .4-35.1 2.1-56.3 8.1l.3.9c21.4-6 43.7-7.6 56.6-8 7.8 14.4 23 23.8 50.2 26.7-3.9 2.6-7.8 7-9.4 14.5-5.3 2.5-21.9 8.7-31.9-8.5.0.0-5.6-10.2-16.3-11 0 0-10.4-.2-.7 6.5.0.0 6.9 3.3 11.7 15.6.0.0 6.3 21 36.4 14.2V177s-.6 7.7-7.7 10.2c0 0-4.2 2.9.3 4.5.0.0 19.5 1.6 19.5-14.4v-23.6s-.8-9.4 3.8-12.6v38.8s-.3 9.3-5.1 12.8c0 0-3.2 5.7 3.8 4.2.0.0 13.4-1.9 14-17.6l.3-39.3h3.2l.3 39.3c.6 15.6 14 17.6 14 17.6 7 1.6 3.8-4.2 3.8-4.2-4.8-3.5-5.1-12.8-5.1-12.8v-38.5c4.6 3.6 3.8 12.3 3.8 12.3v23.6c0 16 19.5 14.4 19.5 14.4 4.5-1.6.3-4.5.3-4.5-7-2.6-7.7-10.2-7.7-10.2v-31c0-12.1-5.1-18.5-10.1-21.8 29-2.9 42.9-12.2 49.3-26.8 12.7.3 35.6 1.9 57.4 8.1l.3-.9c-21.7-6.1-44.4-7.7-57.3-8.1.6-1.5 1.1-3 1.6-4.6C212.9 91.4 234.6 91.4 255.8 95.6zm0 0"/><path fill="#f5ccb3" d="M174.6 63.7c6.2 5.7 9.9 12.5 9.9 19.8.0 34.4-25.6 35.3-57.2 35.3S70.1 114 70.1 83.5c0-7.3 3.6-14.1 9.8-19.7 10.3-9.4 27.7-4.4 47.4-4.4 19.7.0 37-5.1 47.3 4.3zm0 0"/><path fill="#fff" d="M108.3 85.3c0 9.5-5.3 17.1-11.9 17.1-6.6.0-11.9-7.7-11.9-17.1.0-9.5 5.3-17.1 11.9-17.1C103 68.1 108.3 75.8 108.3 85.3zm0 0"/><path fill="#af5c51" d="M104.5 85.5c0 6.3-3.6 11.4-7.9 11.4-4.4.0-7.9-5.1-7.9-11.4.0-6.3 3.6-11.4 7.9-11.4S104.5 79.2 104.5 85.5zm0 0"/><path fill="#fff" d="M172.2 85.3c0 9.5-5.3 17.1-11.9 17.1s-11.9-7.7-11.9-17.1c0-9.5 5.3-17.1 11.9-17.1C166.8 68.1 172.2 75.8 172.2 85.3zm0 0"/><path fill="#af5c51" d="M168.3 85.5c0 6.3-3.6 11.4-7.9 11.4-4.4.0-7.9-5.1-7.9-11.4.0-6.3 3.6-11.4 7.9-11.4C164.8 74.1 168.3 79.2 168.3 85.5zm0 0"/><path fill="#af5c51" d="M130.5 100.5c0 1.6-1.3 3-3 3-1.6.0-3-1.3-3-3s1.3-3 3-3c1.59999999999999.0 3 1.3 3 3zm0 0"/><path fill="#af5c51" d="M120.6 108c-.2-.5.1-1 .6-1.2s1 .1 1.2.6c.8 2.2 2.8 3.6 5.1 3.6s4.3-1.5 5.1-3.6c.2-.5.7-.8 1.2-.6s.8.7.6 1.2c-1 2.9-3.8 4.9-6.9 4.9C124.4 112.9 121.6 110.9 120.6 108zm0 0"/><path fill="#c4e5d9" d="M54.5 121.6c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4.0-.8.9-1.4 2.1-1.4C53.6 120.2 54.5 120.8 54.5 121.6zm0 0"/><path fill="#c4e5d9" d="M60.3 124.8c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4.0-.8.9-1.4 2.1-1.4C59.4 123.4 60.3 124 60.3 124.8zm0 0"/><path fill="#c4e5d9" d="M63.8 129c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4C62.9 127.5 63.8 128.2 63.8 129zm0 0"/><path fill="#c4e5d9" d="M67 133.8c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4C66.1 132.3 67 133 67 133.8zm0 0"/><path fill="#c4e5d9" d="M70.5 138.2c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4C69.6 136.8 70.5 137.4 70.5 138.2zm0 0"/><path fill="#c4e5d9" d="M75.3 142.1c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4C74.4 140.6 75.3 141.3 75.3 142.1zm0 0"/><path fill="#c4e5d9" d="M82 144.6c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4S82 143.8 82 144.6zm0 0"/><path fill="#c4e5d9" d="M88.7 144.6c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4S88.7 143.8 88.7 144.6zm0 0"/><path fill="#c4e5d9" d="M95.5 143.5c0 .8-.9 1.4-2.1 1.4-1.1.0-2.1-.6-2.1-1.4s.9-1.4 2.1-1.4C94.5 142.1 95.5 142.7 95.5 143.5zm0 0"/></g></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>æš—è‰²æ¨¡å¼</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#ç®€ä»‹>ç®€ä»‹</a></li><li><a href=#ä»£ç åˆä½“éªŒ>ä»£ç åˆä½“éªŒ</a><ol><li><a href=#å®ä¾‹åŒ–>å®ä¾‹åŒ–</a></li><li><a href=#æ„é€ å™¨ç­–ç•¥><strong>æ„é€ å™¨ç­–ç•¥</strong></a></li><li><a href=#æ–‡ä»¶ä¿å­˜>æ–‡ä»¶ä¿å­˜</a></li><li><a href=#å‘½åç­–ç•¥>å‘½åç­–ç•¥</a></li><li><a href=#å­—èŠ‚ç æ³¨å…¥jaråŒ…æˆ–æŒ‡å®šç›®å½•>å­—èŠ‚ç æ³¨å…¥jaråŒ…æˆ–æŒ‡å®šç›®å½•</a></li><li><a href=#ç±»åŠ è½½ç­–ç•¥>ç±»åŠ è½½ç­–ç•¥</a></li></ol></li><li><a href=#å¢å¼ºä¸€ä¸ªç±»>å¢å¼ºä¸€ä¸ªç±»</a><ol><li><a href=#ä¿®æ”¹æ–¹æ³•>ä¿®æ”¹æ–¹æ³•</a></li><li><a href=#æ’å…¥æ–¹æ³•>æ’å…¥æ–¹æ³•</a></li><li><a href=#æ’å…¥å±æ€§>æ’å…¥å±æ€§</a></li><li><a href=#å¢å¼ºç±»>å¢å¼ºç±»</a></li><li><a href=#åŒ¹é…æ–¹æ³•>åŒ¹é…æ–¹æ³•</a></li><li><a href=#å§”æ‰˜æ–¹æ³•>å§”æ‰˜æ–¹æ³•</a></li><li><a href=#åŠ¨æ€ä¿®æ”¹å‚æ•°>åŠ¨æ€ä¿®æ”¹å‚æ•°</a></li><li><a href=#æ„é€ å™¨æ–¹æ³•>æ„é€ å™¨æ–¹æ³•</a></li><li><a href=#å¸¸ç”¨æ ¸å¿ƒapi>å¸¸ç”¨æ ¸å¿ƒAPI</a></li></ol></li><li><a href=#é“¾æ¥>é“¾æ¥</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/jvm/>JVM</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/>I: ByteBuddyå…¥é—¨ç¬”è®°1</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Aug 06, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>é˜…è¯»æ—¶é•¿: 18 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=ç®€ä»‹>ç®€ä»‹</h2><ul><li>ByteBuddyæ”¯æŒæ£€æµ‹å’Œä¿®æ”¹ç°æœ‰Javaå­—èŠ‚ç çš„å·¥å…·ã€‚</li><li>æ·»åŠ æ–°çš„æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡</li><li>åˆ é™¤ç°æœ‰æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®Ãä¾‹å˜é‡</li><li>ä¿®æ”¹å®ä¾‹å˜é‡çš„å€¼ã€‚</li><li>ä¿®æ”¹æ–¹æ³•å‚æ•°çš„å€¼ã€‚</li><li>æ£€æŸ¥ç°æœ‰çš„Javaç±»ç»“æ„ã€æ„é€ å‡½æ•°ç­¾åã€æ–¹æ³•ç­¾åå’Œå®ä¾‹å˜é‡ã€‚</li><li>ç”Ÿæˆæ–°çš„æ³›å‹Javaç±»ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå®ä¾‹å˜é‡ï¼ˆä¸Šç•Œã€ä¸‹ç•Œã€å¤šç•Œã€é€šé…ç¬¦ã€å‚æ•°åŒ–ç±»å‹ã€æ–¹æ³•ç±»å‹å‚æ•°ï¼‰</li><li>æœç´¢å¹¶æ›¿æ¢æ–¹æ³•ä¸­çš„ä»£ç ã€‚</li><li>æ·»åŠ å’Œåˆ é™¤å¯¹Javaç±»ã€æ„é€ å‡½æ•°ã€æ–¹æ³•ã€å®ä¾‹å˜é‡å’Œå‚æ•°è¿›è¡Œæ³¨é‡Šçš„æ³¨é‡Š</li><li>æ·»åŠ å’Œä¿®æ”¹Javaå†…éƒ¨ç±»ï¼ˆæ·»åŠ ç¬¬ä¸€çº§å’Œç¬¬äºŒçº§linnerç±»ï¼Œæ‹¦æˆªå†…éƒ¨ç±»å’ŒåŒ¿åç±»ï¼‰ã€‚</li><li>ç”Ÿæˆæ–°çš„Javaç±»ã€Javaæ¥å£ã€æšä¸¾ã€æ³¨é‡Šå’ŒæŠ½è±¡ç±»ã€‚</li><li>ç”Ÿæˆç®€å•æ–¹æ³•å’Œlambdaè¡¨è¾¾å¼ã€‚</li><li>åœ¨Adviceä»£ç ä¹‹é—´å…±äº«æ•°æ®ã€‚</li></ul><h2 id=ä»£ç åˆä½“éªŒ>ä»£ç åˆä½“éªŒ</h2><p>åœ¨è¿›è¡ŒByte Buddyä¹‹å‰å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç„¶åå¼•å…¥ç›¸å…³ä¾èµ–ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>net.bytebuddy<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>byte-buddy<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.12.10<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.junit.jupiter<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>junit-jupiter<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>5.6.3<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;scope&gt;</span>test<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>commons-io<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>commons-io<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>2.11.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.projectlombok<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>lombok<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.18.16<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupId&gt;</span>org.slf4j<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;artifactId&gt;</span>slf4j-log4j12<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;version&gt;</span>1.7.25<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependencies&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•ç±»å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateClassTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>String</span> <span class=n>path</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰è·å–CreateClassTestçš„è·¯å¾„
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeforeAll</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>before</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>CreateClassTest</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>().</span><span class=na>getResource</span><span class=o>(</span><span class=s>&#34;&#34;</span><span class=o>).</span><span class=na>getPath</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ç”Ÿæˆä¸€ä¸ªç±»
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>Object</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>//è·å–ç”Ÿæˆç±»çš„å­—èŠ‚ç 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>DynamicTypeï¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºçš„åŠ¨æ€ç±»å‹ï¼Œé€šå¸¸ä½œä¸ºåº”ç”¨DynamicType.Builderæˆ–.AuxiliaryTypeçš„ç»“æœã€‚</p></li><li><p>Unloadedï¼šå°šæœªè¢«ç»™å®šClassLoaderåŠ è½½çš„åŠ¨æ€ç±»å‹ã€‚</p><p><code>interface Unloaded&lt;T> extends DynamicType</code></p><p>ç±»å‹å‚æ•°: -ç”±è¯¥åŠ¨æ€ç±»å‹å®ç°çš„æœ€å…·ä½“çš„å·²çŸ¥åŠ è½½ç±»å‹ï¼Œé€šå¸¸æ˜¯ç±»å‹æœ¬èº«ã€æ¥å£æˆ–ç›´æ¥çš„è¶…ç±»ã€‚</p></li><li><p>ByteBuddyï¼šåœ¨åˆ›å»ºæ—¶ï¼ŒByte Buddyä¼šå°è¯•å‘ç°å½“å‰JVMçš„ç‰ˆæœ¬ã€‚å¦‚æœä¸å¯èƒ½ï¼Œåˆ™åˆ›å»ºä¸Java 6å…¼å®¹çš„ç±»æ–‡ä»¶ã€‚</p></li><li><p>subclassï¼šç”¨äºåˆ›å»ºæ‰€æä¾›ç±»å‹çš„å­ç±»ï¼Œå¦‚æœæä¾›çš„ç±»å‹æ˜¯æ¥å£ï¼Œåˆ™åˆ›å»ºå®ç°æ­¤æ¥å£ç±»å‹çš„æ–°ç±»ã€‚</p><p>å½“æ‰©å±•ä¸€ä¸ªç±»æ—¶ï¼ŒByte Buddyæ¨¡ä»¿å­ç±»ç±»å‹çš„æ‰€æœ‰å¯è§æ„é€ å‡½æ•°ã€‚ä»»ä½•æ„é€ å‡½æ•°éƒ½è¢«å®ç°ä¸ºåªè°ƒç”¨å…¶å…·æœ‰ç›¸åŒç­¾åçš„è¶…ç±»å‹æ„é€ å‡½æ•°ã€‚å¦ä¸€ç§è¡Œä¸ºå¯ä»¥é€šè¿‡<code>subclass(Class, ConstructorStrategy)</code>æä¾›æ˜¾å¼çš„ConstructorStrategyæ¥æŒ‡å®šã€‚ æ³¨æ„:å¦‚æœæ‰€æä¾›çš„ç±»å‹å£°æ˜äº†ç±»å‹å˜é‡æˆ–æ‰€æœ‰è€…ç±»å‹ï¼Œåˆ™æ­¤æ–¹æ³•ä»¥æ³›å‹çŠ¶æ€å®ç°å®ƒä»¬ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl> <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * é€šè¿‡æ„é€ å™¨ç­–ç•¥ç”Ÿæˆä¸€ä¸ªç±»
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createByConstructorStrategy</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>ConstructorStrategy</span><span class=o>.</span><span class=na>Default</span><span class=o>.</span><span class=na>NO_CONSTRUCTORS</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>//è·å–ç”Ÿæˆç±»çš„å­—èŠ‚ç 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=å®ä¾‹åŒ–>å®ä¾‹åŒ–</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>Object</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>loaded</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>()).</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=n>loaded</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;toString&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>loaded</span><span class=o>.</span><span class=na>newInstance</span><span class=o>()));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ„é€ å™¨ç­–ç•¥><strong>æ„é€ å™¨ç­–ç•¥</strong></h3><ul><li>NO_CONSTRUCTORSï¼šæ­¤ç­–ç•¥ä¸æ·»åŠ æ„é€ å‡½æ•°</li><li>DEFAULT_CONSTRUCTORï¼šè¿™ä¸ªç­–ç•¥æ˜¯æ·»åŠ ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°æ¥è°ƒç”¨å®ƒçš„è¶…ç±»å‹é»˜è®¤æ„é€ å‡½æ•°ã€‚</li><li>IMITATE_SUPER_CLASSï¼šè¿™ç§ç­–ç•¥æ˜¯æ·»åŠ æ’è£…ç±»å‹çš„è¶…ç±»çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ„é€ å‡½æ•°éƒ½ç›´æ¥è°ƒç”¨å…¶ç­¾åç­‰æ•ˆçš„è¶…ç±»æ„é€ å‡½æ•°ã€‚</li><li>IMITATE_SUPER_CLASS_PUBLICï¼šè¿™ç§ç­–ç•¥æ˜¯æ·»åŠ æ’è£…ç±»å‹çš„è¶…ç±»çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ„é€ å‡½æ•°éƒ½ç›´æ¥è°ƒç”¨å…¶ç­¾åç­‰æ•ˆçš„è¶…ç±»æ„é€ å‡½æ•°ï¼Œåªæ·»åŠ å…¬å…±æ„é€ å‡½æ•°ã€‚</li><li>IMITATE_SUPER_CLASS_OPENINGï¼šè¿™ç§ç­–ç•¥æ˜¯æ·»åŠ æ’è£…ç±»å‹çš„è¶…ç±»çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œå…¶ä¸­æ¯ä¸ªæ„é€ å‡½æ•°éƒ½ç›´æ¥è°ƒç”¨å…¶ç­¾åç­‰æ•ˆçš„è¶…ç±»æ„é€ å‡½æ•°ï¼Œä¸ºè¶…ç±»çš„ä»»ä½•å¯è°ƒç”¨ä¸”å£°æ˜ä¸ºpublicçš„æ„é€ å‡½æ•°æ·»åŠ æ„é€ å‡½æ•°ã€‚</li></ul><p>ä¸Šé¢æ˜¯Byte Buddyæ³¨é‡Šçš„ç›´è¯‘ï¼Œå…·ä½“çš„ä¸€äº›è§£é‡Šä¼šåœ¨ä¸‹é¢æµ‹è¯•ä¸­è§£é‡Šã€‚</p><p>ä¸ºäº†æµ‹è¯•ä»¥ä¸Šç­–ç•¥åˆ›å»ºä¸€ä¸ªç±»ä½œä¸ºç”Ÿæˆç±»å¾—è¶…ç±»ï¼Œå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>CreateByConstructorStrategyEntity</span><span class=o>(</span><span class=n>Long</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>CreateByConstructorStrategyEntity</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity</span><span class=o>(</span><span class=n>Long</span> <span class=n>id</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity</span><span class=o>(</span><span class=n>Long</span> <span class=n>id</span><span class=o>,</span> <span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>content</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åç”¨ç”¨ä¸Šé¢äº”ç§ç­–ç•¥åˆ†åˆ«ç”Ÿæˆæ–°ç±»ï¼Œå¹¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createByConstructorStrategy</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>ConstructorStrategy</span><span class=o>.</span><span class=na>Default</span><span class=o>.</span><span class=na>NO_CONSTRUCTORS</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>NO_CONSTRUCTORSï¼šä¸ç”Ÿæˆæ„é€ å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity$ByteBuddy$3c1yosow</span> <span class=kd>extends</span> <span class=n>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>DEFAULT_CONSTRUCTORï¼šç»™ä¸€ä¸ªé»˜è®¤æ„é€ å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity$ByteBuddy$sEqzBgYH</span> <span class=kd>extends</span> <span class=n>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$sEqzBgYH</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>IMITATE_SUPER_CLASSï¼šæ·»åŠ è¶…ç±»æ‰€æœ‰å¯è®¿é—®çš„æ„é€ å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity$ByteBuddy$w3TC5Z4k</span> <span class=kd>extends</span> <span class=n>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$w3TC5Z4k</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>,</span> <span class=n>String</span> <span class=n>var3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>,</span> <span class=n>var3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$w3TC5Z4k</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$w3TC5Z4k</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$w3TC5Z4k</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>IMITATE_SUPER_CLASS_PUBLICï¼šæ·»åŠ è¶…ç±»æ‰€æœ‰Publicä¿®é¥°çš„æ„é€ å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity$ByteBuddy$AnM1yaqS</span> <span class=kd>extends</span> <span class=n>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$AnM1yaqS</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>,</span> <span class=n>String</span> <span class=n>var3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>,</span> <span class=n>var3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$AnM1yaqS</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$AnM1yaqS</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>IMITATE_SUPER_CLASS_OPENINGï¼šæ·»åŠ è¶…ç±»æ‰€æœ‰å¯è®¿é—®çš„æ„é€ å™¨å¹¶è½¬æ¢ä¸ºPublic</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity$ByteBuddy$wMHt2jMn</span> <span class=kd>extends</span> <span class=n>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$wMHt2jMn</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>,</span> <span class=n>String</span> <span class=n>var3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>,</span> <span class=n>var3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$wMHt2jMn</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>,</span> <span class=n>String</span> <span class=n>var2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>,</span> <span class=n>var2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$wMHt2jMn</span><span class=o>(</span><span class=n>Long</span> <span class=n>var1</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>var1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CreateByConstructorStrategyEntity$ByteBuddy$wMHt2jMn</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=æ–‡ä»¶ä¿å­˜>æ–‡ä»¶ä¿å­˜</h3><p>ç”Ÿæˆç±»å­—èŠ‚ç å¯ä»¥è¿›è¡Œä¿å­˜<code>unloaded.saveIn(new File(path));</code>ï¼Œä¹Ÿå°±æ˜¯å°†ä½ ç”Ÿæˆçš„å­—èŠ‚ç ä»¥<code>.class</code>æ–‡ä»¶ä¿å­˜åˆ°ç›¸åº”çš„ä½ç½®ï¼Œä½†ï¼Œç»§æ‰¿jdkåŸç”Ÿç±»å’Œç»§æ‰¿è‡ªå®šä¹‰ç±»çš„ä¿å­˜ä½ç½®ä¸åŒã€‚</p><ul><li><p>ç»§æ‰¿jdkåŸç”Ÿç±»ï¼Œæ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>net.bytebuddy.renamed
</span></span></code></pre></td></tr></table></div></div><p>è·¯å¾„ä¸‹ç„¶ååŠ è¶…ç±»çš„è·¯å¾„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>net</span><span class=o>.</span><span class=na>bytebuddy</span><span class=o>.</span><span class=na>renamed</span><span class=o>.</span><span class=na>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Object$ByteBuddy$i0ivrOhL</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>ç»§æ‰¿ç”¨æˆ·è‡ªå®šä¹‰ç±»ï¼Œæ–‡ä»¶è¢«ä¿å­˜å’Œç”Ÿæˆç±»åŒçº§è·¯å¾„ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>com</span><span class=o>.</span><span class=na>importzhh</span><span class=o>.</span><span class=na>bytebuddy</span><span class=o>.</span><span class=na>CreateByConstructorStrategyEntity$ByteBuddy$AnM1yaqS</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><p>æ–°å¢ä¸€ä¸ªæµ‹è¯•ç±»</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>UserService</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;UserServiceå®ä¾‹åŒ–æˆåŠŸ&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>queryUser</span><span class=o>(</span><span class=n>String</span> <span class=n>userId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;queryUser() is invoked&#34;</span><span class=o>+</span><span class=n>userId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;hello:&#34;</span><span class=o>+</span><span class=n>userId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>updateUser</span><span class=o>(</span><span class=n>String</span> <span class=n>userId</span><span class=o>,</span> <span class=n>String</span> <span class=n>userName</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;updateUser() is invoked&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>deleteUser</span><span class=o>(</span><span class=n>String</span> <span class=n>userId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;deleteUser() is invoked&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>foo</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;foo&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æµ‹è¯•å­—èŠ‚ç ä¿å­˜ç­–ç•¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ByteBuddyDemo1</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>path</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@BeforeEach</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>init</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>ByteBuddyDemo1</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getResource</span><span class=o>(</span><span class=s>&#34;&#34;</span><span class=o>).</span><span class=na>getPath</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>path</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * å°†å­—èŠ‚ç ä¿å­˜åˆ°æ–‡ä»¶
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>saveUnloaded</span><span class=o>(</span><span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span><span class=o>,</span> <span class=n>String</span> <span class=n>className</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FileUtils</span><span class=o>.</span><span class=na>writeByteArrayToFile</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span> <span class=o>+</span> <span class=n>className</span><span class=o>),</span> <span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * å¯¹äºç”Ÿæˆçš„ç±»çš„å‘½åè§„åˆ™
</span></span></span><span class=line><span class=cl><span class=cm>     * 1ï¼šå¯¹äºjdkçš„ç±»   net.bytebuddy.renamed.java.lang.Object$ByteBuddy$QORhkzsm
</span></span></span><span class=line><span class=cl><span class=cm>     * 2ï¼šå¯¹äºè‡ªå®šä¹‰çš„ç±» org.importzhh.Main$ByteBuddy$vfvp1e2G
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * æŒ‡å®šç”Ÿæˆçš„ç±»çš„å‘½åç­–ç•¥
</span></span></span><span class=line><span class=cl><span class=cm>     * org.importzhh.Main$suffix$oq9xJ5w5
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// unloaded è¡¨ç¤ºç”Ÿæˆçš„å­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvmä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>Object</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// net.bytebuddy.renamed.java.lang.Object$ByteBuddy$QORhkzsm
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test2</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// unloaded è¡¨ç¤ºç”Ÿæˆçš„å­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvmä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// org.itstack.Main$ByteBuddy$vfvp1e2G
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>bytes</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test3</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>SuffixingRandom</span> <span class=n>suffix</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>SuffixingRandom</span><span class=o>(</span><span class=s>&#34;suffix&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// unloaded è¡¨ç¤ºç”Ÿæˆçš„å­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvmä¸­
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ä¸æ ¡éªŒç”Ÿæˆçš„ç±» é»˜è®¤æ˜¯æ ¡éªŒçš„
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=n>TypeValidation</span><span class=o>.</span><span class=na>DISABLED</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=n>suffix</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// org.itstack.Main$ByteBuddy$vfvp1e2G
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>getBytes</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FileUtils</span><span class=o>.</span><span class=na>writeByteArrayToFile</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span> <span class=o>+</span> <span class=s>&#34;TestMain1.class&#34;</span><span class=o>),</span> <span class=n>bytes</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>//        System.out.println(bytes.length);
</span></span></span><span class=line><span class=cl><span class=c1>//        unloaded.saveIn(new File(path));
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// ç”Ÿæˆçš„å­—èŠ‚ç è¿˜å¯ä»¥ç›´æ¥æ³¨å…¥åˆ°æŸä¸ªjaråŒ…ä¸­
</span></span></span><span class=line><span class=cl><span class=c1>//        unloaded.inject(new File(&#34;a.jar&#34;));
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å‘½åç­–ç•¥>å‘½åç­–ç•¥</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createWithNameStrategy</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>SuffixingRandom</span> <span class=n>suffixingRandom</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>SuffixingRandom</span><span class=o>(</span><span class=s>&#34;importzhh&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=n>suffixingRandom</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç”Ÿæˆçš„ç±»åä¸º<code>CreateByConstructorStrategyEntity$importzhh$OnHkVvgk</code>,å¦‚æœä¸æŒ‡å®šç”Ÿæˆç­–ç•¥åˆ™ç”Ÿæˆçš„ç±»åå¦‚ä¸‹</p><p>è¶…ç±»ç±»å+ByteBuddy+8ä½éšæœºå­—ç¬¦</p><p>å¢åŠ <code>SuffixingRandom</code>åˆ™è‡ªå®šä¹‰çš„åç¼€å°†æ›¿æ¢<code>ByteBuddy</code>ï¼Œå¦‚æœå°†å‘½åç­–ç•¥æ”¹ä¸ºPrefixingRandomåˆ™å‘½åç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>importzhh.com.importzhh.bytebuddy</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šç±»å</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createWithName</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Unloadedä»£è¡¨ç”Ÿæˆå­—èŠ‚ç è¿˜æœªåŠ è½½åˆ°jvm
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>//æŒ‡å®šçˆ¶ç±»
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;cn.importzhh.NewCreateByConstructorStrategyEntity&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>è‡ªå®šä¹‰å‘½åç­–ç•¥</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createWithSelfDefineNameStrategy</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=c1>//ä½¿ç”¨è‡ªå®šä¹‰å‘½åç­–ç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=k>new</span> <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>AbstractBase</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>protected</span> <span class=n>String</span> <span class=nf>name</span><span class=o>(</span><span class=n>TypeDescription</span> <span class=n>superClass</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=s>&#34;com.test.&#34;</span> <span class=o>+</span> <span class=n>superClass</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>})</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>canonicalName</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>()).</span><span class=na>getLoaded</span><span class=o>().</span><span class=na>getCanonicalName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>canonicalName</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å­—èŠ‚ç æ³¨å…¥jaråŒ…æˆ–æŒ‡å®šç›®å½•>å­—èŠ‚ç æ³¨å…¥jaråŒ…æˆ–æŒ‡å®šç›®å½•</h3><p>ä¹Ÿå¯ä»¥å°†å­—èŠ‚ç æ³¨å…¥åˆ°å·²æœ‰çš„jarä¸­ï¼Œä»£ç å’Œæ“ä½œç»“æœå¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * ä»æŒ‡å®šç›®å½•æˆ–jaråŒ…ä¸­è·å–ç±»çš„ä¿¡æ¯
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws IOException
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test9</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//ä»å½“å‰ç›®å½•ä¸‹çš„jaræ–‡ä»¶ä¸­æ‰¾åˆ°ç±»æ–‡ä»¶ã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ClassFileLocator</span> <span class=n>classFileLocator</span> <span class=o>=</span> <span class=n>ClassFileLocator</span><span class=o>.</span><span class=na>ForJarFile</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;/Users/importzhh/.m2/repository/commons-io/commons-io/2.11.0/commons-io-2.11.0.jar&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=c1>//åˆ›å»ºä¸€ä¸ªCompoundå¯¹è±¡ ç”¨äºå°†å¤šä¸ªClassFileLocatorç»„åˆåœ¨ä¸€èµ·ã€‚è¿™é‡Œåªæœ‰ä¸€ä¸ªClassFileLocator
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ClassFileLocator</span><span class=o>.</span><span class=na>Compound</span> <span class=n>compound</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassFileLocator</span><span class=o>.</span><span class=na>Compound</span><span class=o>(</span><span class=n>classFileLocator</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//ä»compoundä¸­è·å–ç±»çš„ä¿¡æ¯
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>TypePool</span> <span class=n>typePool</span> <span class=o>=</span> <span class=n>TypePool</span><span class=o>.</span><span class=na>Default</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>compound</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>//è·å–äº†&#34;org.apache.commons.io.FileUtils&#34;è¿™ä¸ªç±»çš„æè¿°ä¿¡æ¯ï¼Œå¹¶è§£æå®ƒã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>TypeDescription</span> <span class=n>typeDescription</span> <span class=o>=</span> <span class=n>typePool</span><span class=o>.</span><span class=na>describe</span><span class=o>(</span><span class=s>&#34;org.apache.commons.io.FileUtils&#34;</span><span class=o>).</span><span class=na>resolve</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>redefine</span><span class=o>(</span><span class=n>typeDescription</span><span class=o>,</span> <span class=n>classFileLocator</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;sizeOf&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FixedValue</span><span class=o>.</span><span class=na>nullValue</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=ç±»åŠ è½½ç­–ç•¥>ç±»åŠ è½½ç­–ç•¥</h3><p>DynamicType.Unloadedï¼Œä»£è¡¨ä¸€ä¸ªå°šæœªåŠ è½½çš„ç±»ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™äº›ç±»å‹ä¸ä¼šåŠ è½½åˆ° Java è™šæ‹Ÿæœºä¸­ï¼Œå®ƒä»…ä»…è¡¨ç¤ºåˆ›å»ºå¥½äº†ç±»çš„å­—èŠ‚ç ï¼Œé€šè¿‡ DynamicType.Unloaded ä¸­çš„ getBytes æ–¹æ³•ä½ å¯ä»¥è·å–åˆ°è¯¥å­—èŠ‚ç ã€‚</p><p>åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½éœ€è¦å°†è¯¥å­—èŠ‚ç ä¿å­˜åˆ°æ–‡ä»¶ï¼Œæˆ–è€…æ³¨å…¥çš„ç°åœ¨çš„ jar æ–‡ä»¶ä¸­ï¼Œå› æ­¤è¯¥ç±»å‹è¿˜æä¾›äº†ä¸€ä¸ª saveIn(File) æ–¹æ³•ï¼Œå¯ä»¥å°†ç±»å­˜å‚¨åœ¨ç»™å®šçš„æ–‡ä»¶å¤¹ä¸­ï¼› inject(File) æ–¹æ³•å°†ç±»æ³¨å…¥åˆ°ç°æœ‰çš„ Jar æ–‡ä»¶ä¸­ï¼Œå¦å¤–ä½ åªéœ€è¦å°†è¯¥å­—èŠ‚ç ç›´æ¥åŠ è½½åˆ°è™šæ‹Ÿæœºä½¿ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡ ClassLoadingStrategy æ¥åŠ è½½ã€‚</p><p><code>ClassLoadingStrategy</code> æ˜¯ Byte Buddy åº“ä¸­ç”¨äºå®šä¹‰å¦‚ä½•åŠ è½½åŠ¨æ€åˆ›å»ºæˆ–ä¿®æ”¹çš„ç±»çš„ç­–ç•¥ï¼Œå†…ç½®çš„ç­–ç•¥å®šä¹‰åœ¨æšä¸¾ClassLoadingStrategy.Defaultä¸­</p><p>è¿™ä¸ªç­–ç•¥å†³å®šäº†æ–°ç”Ÿæˆçš„ç±»åº”è¯¥è¢«å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œä»¥åŠç”Ÿæˆçš„ç±»åº”è¯¥å¦‚ä½•ä¸ç°æœ‰çš„ç±»å…³è”ã€‚è¿™é‡Œæœ‰å‡ ç§ç­–ç•¥ï¼š</p><ul><li><p><code>WRAPPER</code>ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†è¢«ä¸å…¶çˆ¶ç±»ç›¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚
åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œæ–°ç”Ÿæˆçš„ç±»ä¸èƒ½è®¿é—®åˆ°æ¯”å…¶çˆ¶ç±»æ›´é«˜çº§çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ã€‚ç”Ÿæˆçš„ç±»åªèƒ½è®¿é—®åˆ°å…¶çˆ¶ç±»å¯ä»¥è®¿é—®åˆ°çš„ç±»ã€‚</p></li><li><p><code>WRAPPER_PERSISTENT</code>ï¼šè¿™ä¸ªç­–ç•¥ä¸ <code>WRAPPER</code> ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä¼šåœ¨ç±»è¢«åŠ è½½æ—¶ç”Ÿæˆä¸€ä¸ªç±»æ¸…å•ï¼ˆmanifestï¼‰ã€‚
è¿™ä¸ªæ¸…å•å¯ä»¥ç”¨äºåœ¨è¿è¡Œæ—¶è·å–å…³äºç±»çš„å…ƒæ•°æ®ã€‚</p></li><li><p><code>CHILD_FIRST</code>ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†è¢«ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå­åŠ è½½å™¨ä¼˜å…ˆè´Ÿè´£åŠ è½½ç›®æ ‡ç±»
è¿™ä¸ªæ–°çš„ç±»åŠ è½½å™¨å°†å…¶çˆ¶ç±»çš„ç±»åŠ è½½å™¨ä½œä¸ºå…¶çˆ¶åŠ è½½å™¨ã€‚åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œæ–°ç”Ÿæˆçš„ç±»å¯ä»¥è®¿é—®åˆ°æ¯”å…¶çˆ¶ç±»æ›´é«˜çº§çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ã€‚</p></li><li><p><code>CHILD_FIRST_PERSISTENT</code>ï¼šè¿™ä¸ªç­–ç•¥ä¸ <code>CHILD_FIRST</code> ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šåœ¨ç±»è¢«åŠ è½½æ—¶ç”Ÿæˆä¸€ä¸ªç±»æ¸…å•ã€‚</p></li><li><p><code>INJECTION</code>ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†ç›´æ¥è¢«æ³¨å…¥åˆ°å…¶çˆ¶ç±»æ‰€åœ¨çš„ç±»åŠ è½½å™¨ã€‚åˆ©ç”¨åå°„æœºåˆ¶æ³¨å…¥åŠ¨æ€ç±»å‹
è¿™éœ€è¦ç±»åŠ è½½å™¨æ”¯æŒç±»çš„åŠ¨æ€æ³¨å…¥ã€‚è¿™äº›ç­–ç•¥çš„é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ éœ€è¦æ–°ç”Ÿæˆçš„ç±»èƒ½å¤Ÿè®¿é—®åˆ°æ›´å¤šçš„ç±»ï¼Œ
ä½ å¯èƒ½éœ€è¦é€‰æ‹© <code>CHILD_FIRST</code> æˆ– <code>CHILD_FIRST_PERSISTENT</code> ç­–ç•¥ã€‚å¦‚æœä½ ä¸éœ€è¦è¿™æ ·çš„åŠŸèƒ½ï¼Œ
é‚£ä¹ˆ <code>WRAPPER</code> æˆ– <code>WRAPPER_PERSISTENT</code> ç­–ç•¥å¯èƒ½ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicClass</span> <span class=o>=</span> <span class=n>dynamicType</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>Object</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>ClassLoadingStrategy</span><span class=o>.</span><span class=na>Default</span><span class=o>.</span><span class=na>WRAPPER</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬ä½¿ç”¨ WRAPPER ç­–ç•¥æ¥åŠ è½½é€‚åˆå¤§å¤šæ•°æƒ…å†µçš„ç±»ï¼Œè¿™æ ·ç”Ÿäº§çš„åŠ¨æ€ç±»ä¸ä¼šè¢«ApplicationClassLoaderåŠ è½½åˆ°ï¼Œä¸ä¼šå½±å“åˆ°é¡¹ç›®ä¸­å·²ç»å­˜åœ¨çš„ç±»getLoaded æ–¹æ³•è¿”å›ä¸€ä¸ª Java Class çš„å®ä¾‹ï¼Œå®ƒå°±è¡¨ç¤ºç°åœ¨åŠ è½½çš„åŠ¨æ€ç±»</p><h2 id=å¢å¼ºä¸€ä¸ªç±»>å¢å¼ºä¸€ä¸ªç±»</h2><h3 id=ä¿®æ”¹æ–¹æ³•>ä¿®æ”¹æ–¹æ³•</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æµ‹è¯•ç»§æ‰¿UserManager æ‹¦æˆª queryUser æ–¹æ³• å¹¶è¿”å›ç©ºå€¼
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test5</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;a.b.subObjType&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FixedValue</span><span class=o>.</span><span class=na>nullValue</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>saveUnloaded</span><span class=o>(</span><span class=n>unloaded</span><span class=o>,</span> <span class=s>&#34;TestUserManager1.class&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æµ‹è¯•redefine UserManager queryUser æ–¹æ³• å¹¶è¿”å›ç©ºå€¼
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test6</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>redefine</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>name</span><span class=o>(</span><span class=s>&#34;a.b.subObjType&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FixedValue</span><span class=o>.</span><span class=na>nullValue</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>saveUnloaded</span><span class=o>(</span><span class=n>unloaded</span><span class=o>,</span> <span class=s>&#34;TestUserManager2.class&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ’å…¥æ–¹æ³•>æ’å…¥æ–¹æ³•</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æµ‹è¯•bytebuddyå‘ UserManager æ’å…¥ä¸€ä¸ªæ–°æ–¹æ³• testAdd
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test7</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>redefine</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>defineMethod</span><span class=o>(</span><span class=s>&#34;testAdd&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Modifier</span><span class=o>.</span><span class=na>PUBLIC</span><span class=o>+</span><span class=n>Modifier</span><span class=o>.</span><span class=na>STATIC</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>withParameter</span><span class=o>(</span><span class=n>String</span><span class=o>[].</span><span class=na>class</span><span class=o>,</span> <span class=s>&#34;args&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FixedValue</span><span class=o>.</span><span class=na>value</span><span class=o>(</span><span class=s>&#34;è¿™æ˜¯bytebuddyæ–°å¢çš„æ–¹æ³•&#34;</span><span class=o>))</span> <span class=c1>//è¿™é‡Œæ˜¯æ–°æ–¹æ³•çš„å®ç°ï¼Œè¿™é‡Œå°†toString()æ–¹æ³•è¿”å›å›ºå®šå­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>saveUnloaded</span><span class=o>(</span><span class=n>unloaded</span><span class=o>,</span> <span class=s>&#34;TestUserManager3.class&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ’å…¥å±æ€§>æ’å…¥å±æ€§</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * å‘UserManageræ’å…¥ä¸€ä¸ªæ–°å±æ€§
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test8</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>redefine</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>defineField</span><span class=o>(</span><span class=s>&#34;systemShort&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Modifier</span><span class=o>.</span><span class=na>PRIVATE</span><span class=o>)</span> <span class=c1>// å®šä¹‰å±æ€§
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>defineMethod</span><span class=o>(</span><span class=s>&#34;getSystemShort&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Modifier</span><span class=o>.</span><span class=na>PUBLIC</span><span class=o>)</span> <span class=c1>// å®šä¹‰getteræ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FieldAccessor</span><span class=o>.</span><span class=na>ofField</span><span class=o>(</span><span class=s>&#34;systemShort&#34;</span><span class=o>))</span> <span class=c1>// æŒ‡å®šgetteræ–¹æ³•è¿”å›å­—æ®µçš„å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>defineMethod</span><span class=o>(</span><span class=s>&#34;setSystemShort&#34;</span><span class=o>,</span> <span class=kt>void</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>Modifier</span><span class=o>.</span><span class=na>PUBLIC</span><span class=o>)</span> <span class=c1>// å®šä¹‰setteræ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>withParameters</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=c1>// æŒ‡å®šsetteræ–¹æ³•çš„å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FieldAccessor</span><span class=o>.</span><span class=na>ofField</span><span class=o>(</span><span class=s>&#34;systemShort&#34;</span><span class=o>))</span>  <span class=c1>// æŒ‡å®šsetteræ–¹æ³•è®¾ç½®å­—æ®µçš„å€¼
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>saveUnloaded</span><span class=o>(</span><span class=n>unloaded</span><span class=o>,</span> <span class=s>&#34;TestUserManager4.class&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¢å¼ºç±»>å¢å¼ºç±»</h3><p>å¢å¼ºä¸€ä¸ªç±»æœ‰ä¸¤ç§æ–¹å¼<code>redefine</code>&<code>rebase</code>ï¼Œä¸<code>subclass</code>ä¸åŒçš„æ˜¯è¿™ä¸¤ç§æ–¹å¼æ˜¯åœ¨åŸæœ‰ç±»çš„åŸºç¡€ä¸Šä¿®æ”¹ï¼Œè€Œ<code>subclass</code>æ˜¯ç”Ÿæˆä¸€ä¸ªå­ç±»ã€‚</p><ul><li>rebaseï¼šä¼šä¿ç•™æ‰€æœ‰è¢«å˜åŸºç±»çš„æ–¹æ³•å®ç°ã€‚Byte Buddy ä¼šç”¨å…¼å®¹çš„ç­¾åå¤åˆ¶æ‰€æœ‰æ–¹æ³•çš„å®ç°ä¸ºä¸€ä¸ªç§æœ‰çš„é‡å‘½åè¿‡çš„æ–¹æ³•ï¼Œ è€Œä¸åƒç±»é‡å®šä¹‰æ—¶ä¸¢å¼ƒè¦†å†™çš„æ–¹æ³•ã€‚ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œä¸å­˜åœ¨æ–¹æ³•å®ç°çš„ä¸¢å¤±ï¼Œè€Œä¸”å˜åŸºçš„æ–¹æ³•å¯ä»¥é€šè¿‡è°ƒç”¨è¿™äº›é‡å‘½åçš„æ–¹æ³•ï¼Œ ç»§ç»­è°ƒç”¨åŸå§‹çš„æ–¹æ³•ã€‚</li><li>redifineï¼šå…è®¸é€šè¿‡æ·»åŠ å­—æ®µå’Œæ–¹æ³•æˆ–è€…æ›¿æ¢å·²å­˜åœ¨çš„æ–¹æ³•å®ç°æ¥ä¿®æ”¹å·²å­˜åœ¨çš„ç±»ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ–¹æ³•çš„å®ç°è¢«å¦ä¸€ä¸ªå®ç°æ‰€æ›¿æ¢ï¼Œä¹‹å‰çš„å®ç°å°±ä¼šä¸¢å¤±ã€‚</li></ul><p>ä½¿ç”¨rebaseå°†ä¹‹å‰æµ‹è¯•çš„å®ä½“ç±»å¢åŠ ä¸€ä¸ªgetIdæ–¹æ³•å¹¶è¿”å›å›ºå®šå€¼0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CreateByConstructorStrategyEntity</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>.....</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Long</span> <span class=nf>getId</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0L</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>.....</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åä»¥rebaseçš„æ–¹å¼å°†å…¶ä¿®æ”¹ï¼Œä½¿getIdæ–¹æ³•çš„è¿”å›å€¼ä¿®æ”¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>dynamicEnhanceByRebase</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>with</span><span class=o>(</span><span class=k>new</span> <span class=n>NamingStrategy</span><span class=o>.</span><span class=na>AbstractBase</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>protected</span> <span class=n>String</span> <span class=nf>name</span><span class=o>(</span><span class=n>TypeDescription</span> <span class=n>superClass</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=s>&#34;top.eacape.&#34;</span> <span class=o>+</span> <span class=n>superClass</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>})</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>rebase</span><span class=o>(</span><span class=n>CreateByConstructorStrategyEntity</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.&lt;</span><span class=n>MethodDescription</span><span class=o>&gt;</span><span class=n>named</span><span class=o>(</span><span class=s>&#34;getId&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>FixedValue</span><span class=o>.</span><span class=na>value</span><span class=o>(</span><span class=mi>50L</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>unloaded</span><span class=o>.</span><span class=na>saveIn</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>path</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ç”¨ideaç›´æ¥æŸ¥çœ‹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æŸ¥çœ‹å­—èŠ‚ç å‘ç°è¿™ä¸ªæ–‡ä»¶ä¸­è¿˜æœ‰ä¸€ä¸ªä»¥getIdå¼€å¤´çš„æ–¹æ³•ï¼Œå®ƒçš„è¿”å›å€¼ä¸º0ï¼Œä»£è¡¨getIdçš„åŸå§‹æ–¹æ³•
<img src=/p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/img2013080716400001.png width=639 height=393 srcset="/p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/img2013080716400001_hu2c9f5f678660b3d3010ca7a01d15c6f8_120453_480x0_resize_box_3.png 480w, /p/i-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B01/img2013080716400001_hu2c9f5f678660b3d3010ca7a01d15c6f8_120453_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=162 data-flex-basis=390px></p><p>åè§‚ä½¿ç”¨redefineå°±æ²¡æœ‰è¿™ç§æ•ˆæœ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * rebaseæ–¹å¼
</span></span></span><span class=line><span class=cl><span class=cm> *
</span></span></span><span class=line><span class=cl><span class=cm> * è¿™ç§æ–¹å¼è¡¨ç¤ºçš„æ˜¯åœ¨ä¸€ä¸ªç±»çš„æ–¹æ³•ä¸Šé‡æ–°å®šä¹‰å®ç°ï¼ˆå°±åƒæ˜¯åœ¨æ›¿æ¢æ–¹æ³•ä¸­çš„å­—èŠ‚ç ä¸€æ ·ï¼‰ï¼Œä½†ä¿ç•™åŸæ¥æ–¹æ³•çš„å­—èŠ‚ç ï¼Œå¹¶ä¸”åœ¨æ–°æ–¹æ³•ä¸­è°ƒç”¨ã€‚
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ByteBuddyDemo2Rebase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicType</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>rebase</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>MethodDelegation</span><span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=n>InterceptorClass</span><span class=o>.</span><span class=na>class</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>ByteBuddyDemo2Rebase</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>dynamicType</span><span class=o>.</span><span class=na>getDeclaredMethod</span><span class=o>(</span><span class=s>&#34;hello&#34;</span><span class=o>).</span><span class=na>invoke</span><span class=o>(</span><span class=n>instance</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>InterceptorClass</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>foo</span><span class=o>(</span><span class=nd>@SuperCall</span> <span class=n>Callable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>zuper</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Before invoking original method&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=n>zuper</span><span class=o>.</span><span class=na>call</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;After invoking original method&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=åŒ¹é…æ–¹æ³•>åŒ¹é…æ–¹æ³•</h3><h3 id=å§”æ‰˜æ–¹æ³•>å§”æ‰˜æ–¹æ³•</h3><p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ–¹æ³•è¿”å›ä¸€ä¸ªå›ºå®šå€¼å½“ç„¶æ˜¯ä¸å¤Ÿçš„ã€‚ä¸ºäº†æ›´å¥½çš„çµæ´»æ€§ï¼ŒByte Buddy æä¾›äº†<code>MethodDelegation(æ–¹æ³•å§”æ‰˜)</code>å®ç°ï¼Œ å®ƒåœ¨å¯¹æ–¹æ³•è°ƒç”¨åšå‡ºååº”æ—¶æä¾›æœ€å¤§ç¨‹åº¦çš„è‡ªç”±ã€‚ä¸€ä¸ªæ–¹æ³•å§”æ‰˜å®šä¹‰äº†åŠ¨æ€åˆ›å»ºçš„ç±»æ–¹æ³•ï¼Œåˆ°å¦å¤–ä¸€ä¸ªå¯èƒ½å­˜åœ¨äºåŠ¨æ€ç±»å‹ä¹‹å¤–çš„æ–¹æ³•çš„ä»»ä½•è°ƒç”¨ã€‚ è¿™æ ·ï¼ŒåŠ¨æ€ç±»çš„é€»è¾‘å¯ä»¥ç”¨ç®€å•çš„ Java è¡¨ç¤ºï¼Œä»…é€šè¿‡ä»£ç ç”Ÿæˆå°±å¯ä»¥ä¸å¦å¤–çš„æ–¹æ³•ç»‘å®šã€‚</p><p>å®ç°å§”æ‰˜æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é™æ€æ–¹æ³•å§”æ‰˜ï¼Œä¸€ç§æ˜¯æˆå‘˜æ–¹æ³•å§”æ‰˜</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.ByteBuddy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.MethodDelegation</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.matcher.ElementMatchers</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.itstack.UserService</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.api.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.reflect.Method</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.concurrent.Callable</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ByteBuddyDemo3Delegation</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     *  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŸå§‹çš„fooæ–¹æ³•è¢«æ’æ¡©å¹¶æ›¿æ¢ä¸ºæ–°çš„MethodInterceptor.interceptæ–¹æ³•ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>     *  è¿™å°±æ˜¯ä½¿ç”¨ByteBuddyå¯¹å®ä¾‹æ–¹æ³•è¿›è¡Œæ’æ¡©çš„ä¸€ç§åŸºæœ¬æ–¹å¼ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     *  æ–¹æ³•å§”æ‰˜ ä¸è¢«æ‹¦æˆªæ–¹æ³•åŒç­¾å ä¸”æ˜¯é™æ€æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test1</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicType</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>MethodDelegation</span><span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=n>MethodInterceptor</span><span class=o>.</span><span class=na>class</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>foo</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>foo</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>instance</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>  <span class=c1>// prints &#34;intercepted&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     *  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŸå§‹çš„fooæ–¹æ³•è¢«æ’æ¡©å¹¶æ›¿æ¢ä¸ºæ–°çš„MethodInterceptor.interceptæ–¹æ³•ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>     *  è¿™å°±æ˜¯ä½¿ç”¨ByteBuddyå¯¹å®ä¾‹æ–¹æ³•è¿›è¡Œæ’æ¡©çš„ä¸€ç§åŸºæœ¬æ–¹å¼ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     *  æ–¹æ³•å§”æ‰˜ ä¸è¢«æ‹¦æˆªæ–¹æ³•åŒç­¾å ä¸”æ˜¯æˆå‘˜æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test2</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicType</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>MethodDelegation</span><span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=k>new</span> <span class=n>MethodInterceptor2</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>queryUser</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>queryUser</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>instance</span><span class=o>,</span> <span class=s>&#34;testUserId&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>  <span class=c1>// prints &#34;intercepted&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test3</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicType</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>MethodDelegation</span><span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=k>new</span> <span class=n>MethodInterceptor3</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>queryUser</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;queryUser&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>result</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>queryUser</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>instance</span><span class=o>,</span> <span class=s>&#34;testUserId&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>  <span class=c1>// prints &#34;intercepted&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MethodInterceptor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>intercept</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;intercepted&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MethodInterceptor2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>String</span> <span class=nf>intercept</span><span class=o>(</span><span class=n>String</span> <span class=n>userId</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;interceptedï¼š&#34;</span><span class=o>+</span><span class=n>userId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>class</span> <span class=nc>MethodInterceptor3</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>         * æ–¹æ³•ç­¾åæˆ–è¿”å›å€¼å¯ä»¥ä¸è¢«æ‹¦æˆªæ–¹æ³•ä¸ä¸€è‡´
</span></span></span><span class=line><span class=cl><span class=cm>         * @RuntimeType bytebuddyä¼šåœ¨è¿è¡ŒæœŸé—´ç»™è¢«æŒ‡å®šæ³¨è§£ä¿®é¥°çš„æ–¹æ³•å‚æ•°è¿›è¡Œèµ‹å€¼
</span></span></span><span class=line><span class=cl><span class=cm>         * @param targetObj        è¡¨ç¤ºè¢«æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ åªæœ‰æ‹¦æˆªå®ä¾‹æ–¹æ³•æ—¶å¯ç”¨
</span></span></span><span class=line><span class=cl><span class=cm>         * @param targetMethod     è¡¨ç¤ºè¢«æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³• åªæœ‰æ‹¦æˆªå®ä¾‹æ–¹æ³•æˆ–é™æ€æ–¹æ³•å¯ç”¨
</span></span></span><span class=line><span class=cl><span class=cm>         * @param targetMethodArgs ç›®æ ‡æ–¹æ³•çš„å‚æ•°
</span></span></span><span class=line><span class=cl><span class=cm>         * @param targetObj2       è¢«æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ åªæœ‰æ‹¦æˆªå®ä¾‹æ–¹æ³•æ—¶å¯ç”¨
</span></span></span><span class=line><span class=cl><span class=cm>         *            è‹¥ç¡®å®šçˆ¶ç±» ä¹Ÿå¯ç”¨å…·ä½“çš„çˆ¶ç±»æ¥æ¥æ”¶
</span></span></span><span class=line><span class=cl><span class=cm>         * @param zuper            è°ƒç”¨ç›®æ ‡æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=cm>         * 1. `@RuntimeType`: è¿™æ˜¯ä¸€ä¸ªç”¨äºæ–¹æ³•çš„æ³¨è§£ï¼Œç”¨äºå‘ŠçŸ¥Byte Buddyï¼Œæ­¤æ–¹æ³•åœ¨è¿è¡Œæ—¶å°†ä¼šè¢«è°ƒç”¨ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         *                         è¯¥æ³¨è§£é€šå¸¸ç”¨äºæ‹¦æˆªå™¨ç±»çš„æ–¹æ³•ï¼Œä½¿å…¶æˆä¸ºæ–¹æ³•å§”æ‰˜çš„ç›®æ ‡ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         * 2. `@This`: è¯¥æ³¨è§£ç”¨äºæ³¨å…¥å½“å‰è¢«æ‹¦æˆªæ–¹æ³•æ‰€å±çš„å¯¹è±¡ï¼ˆå³ç›®æ ‡å¯¹è±¡ï¼‰ã€‚åœ¨æ‹¦æˆªå™¨æ–¹æ³•ä¸­ï¼Œé€šè¿‡`@This`æ³¨è§£ï¼Œ
</span></span></span><span class=line><span class=cl><span class=cm>         *                         æ‚¨å¯ä»¥è·å–ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶åœ¨æ‹¦æˆªå™¨ä¸­ä½¿ç”¨å®ƒã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         * 3. `@Origin`: è¯¥æ³¨è§£ç”¨äºæ³¨å…¥å½“å‰è¢«æ‹¦æˆªæ–¹æ³•çš„`Method`å¯¹è±¡ï¼Œä»£è¡¨ç›®æ ‡æ–¹æ³•çš„åå°„ä¿¡æ¯ã€‚é€šè¿‡`@Origin`æ³¨è§£ï¼Œ
</span></span></span><span class=line><span class=cl><span class=cm>         *                         æ‚¨å¯ä»¥è·å–ç›®æ ‡æ–¹æ³•çš„åç§°ã€å‚æ•°åˆ—è¡¨ã€è¿”å›ç±»å‹ç­‰ä¿¡æ¯ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         * 4. `@AllArguments`: è¯¥æ³¨è§£ç”¨äºæ³¨å…¥å½“å‰è¢«æ‹¦æˆªæ–¹æ³•çš„æ‰€æœ‰å‚æ•°ã€‚åœ¨æ‹¦æˆªå™¨æ–¹æ³•ä¸­ï¼Œé€šè¿‡`@AllArguments`æ³¨è§£ï¼Œ
</span></span></span><span class=line><span class=cl><span class=cm>         *                         æ‚¨å¯ä»¥è·å–ç›®æ ‡æ–¹æ³•çš„æ‰€æœ‰å‚æ•°ä½œä¸ºä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         * 5. `@Super`: è¯¥æ³¨è§£ç”¨äºæ³¨å…¥ç›®æ ‡æ–¹æ³•çš„çˆ¶ç±»æˆ–çˆ¶æ¥å£å®ä¾‹ã€‚é€šå¸¸ç”¨äºæ‹¦æˆªå™¨æ–¹æ³•ä¸­ï¼Œä½¿å¾—æ‚¨å¯ä»¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯æ‹¦æˆªå®ƒã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         * 6. `@SuperCall`: è¯¥æ³¨è§£ç”¨äºæ³¨å…¥ä¸€ä¸ª`Callable`å¯¹è±¡ï¼Œä»£è¡¨ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨ã€‚åœ¨æ‹¦æˆªå™¨æ–¹æ³•ä¸­ï¼Œé€šè¿‡`@SuperCall`æ³¨è§£ï¼Œ
</span></span></span><span class=line><span class=cl><span class=cm>         *                         æ‚¨å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œå®ç°æ–¹æ³•å§”æ‰˜ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>         */</span>
</span></span><span class=line><span class=cl>        <span class=nd>@RuntimeType</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Object</span> <span class=nf>testDelegation</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=nd>@This</span> <span class=n>Object</span> <span class=n>targetObj</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Origin</span> <span class=n>Method</span> <span class=n>targetMethod</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=nd>@AllArguments</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>targetMethodArgs</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Super</span> <span class=n>Object</span> <span class=n>targetObj2</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=nd>@SuperCall</span> <span class=n>Callable</span><span class=o>&lt;?&gt;</span> <span class=n>zuper</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Before calling method: &#34;</span> <span class=o>+</span> <span class=n>targetMethod</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>call</span> <span class=o>=</span> <span class=n>zuper</span><span class=o>.</span><span class=na>call</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;After calling method: &#34;</span> <span class=o>+</span> <span class=n>targetMethod</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>call</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢çš„å§”æ‰˜æ–¹å¼çœ‹èµ·æ¥è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œæ—¥å¸¸æœ€å¸¸ä½¿ç”¨çš„å§”æ‰˜æ–¹å¼æ˜¯é€šè¿‡æ³¨è§£è¿›è¡Œå‚æ•°ç»‘å®šã€‚</p><div class=table-wrapper><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@Argument</td><td>ç»‘å®šå•ä¸ªå‚æ•°</td></tr><tr><td>@AllArguments</td><td>ç»‘å®šæ‰€æœ‰å‚æ•°çš„æ•°ç»„</td></tr><tr><td>@This</td><td>å½“å‰è¢«æ‹¦æˆªçš„ã€åŠ¨æ€ç”Ÿæˆçš„é‚£ä¸ªå¯¹è±¡</td></tr><tr><td>@Super</td><td>å½“å‰è¢«æ‹¦æˆªçš„ã€åŠ¨æ€ç”Ÿæˆçš„é‚£ä¸ªå¯¹è±¡,ä¸ä¼šç»§æ‰¿åŸæœ‰çš„ç±»</td></tr><tr><td>@Origin</td><td>å¯ä»¥ç»‘å®šåˆ°ä»¥ä¸‹ç±»å‹çš„å‚æ•°ï¼š - Method è¢«è°ƒç”¨çš„åŸå§‹æ–¹æ³• - Constructor è¢«è°ƒç”¨çš„åŸå§‹æ„é€ å™¨ - Class å½“å‰åŠ¨æ€åˆ›å»ºçš„ç±» - MethodHandleMethodTypeString åŠ¨æ€ç±»çš„toString()çš„è¿”å›å€¼ - int åŠ¨æ€æ–¹æ³•çš„ä¿®é¥°ç¬¦</td></tr><tr><td>@DefaultCall</td><td>è°ƒç”¨é»˜è®¤æ–¹æ³•è€Œésuperçš„æ–¹æ³•</td></tr><tr><td>@SuperCall</td><td>ç”¨äºè°ƒç”¨çˆ¶ç±»ç‰ˆæœ¬çš„æ–¹æ³•</td></tr><tr><td>@RuntimeType</td><td>å¯ä»¥ç”¨åœ¨è¿”å›å€¼ã€å‚æ•°ä¸Šï¼Œæç¤ºByteBuddyç¦ç”¨ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥</td></tr><tr><td>@Empty</td><td>æ³¨å…¥å‚æ•°çš„ç±»å‹çš„é»˜è®¤å€¼</td></tr><tr><td>@StubValue</td><td>æ³¨å…¥ä¸€ä¸ªå­˜æ ¹å€¼ã€‚å¯¹äºè¿”å›å¼•ç”¨ã€voidçš„æ–¹æ³•ï¼Œæ³¨å…¥nullï¼›å¯¹äºè¿”å›åŸå§‹ç±»å‹çš„æ–¹æ³•ï¼Œæ³¨å…¥0</td></tr><tr><td>@FieldValue</td><td>æ³¨å…¥è¢«æ‹¦æˆªå¯¹è±¡çš„ä¸€ä¸ªå­—æ®µçš„å€¼</td></tr><tr><td>@Morph</td><td>ç±»ä¼¼äº@SuperCallï¼Œä½†æ˜¯å…è®¸æŒ‡å®šè°ƒç”¨å‚æ•°</td></tr></tbody></table></div><p>æ³¨æ„ç¬¬ä¸‰ç§æ³¨è§£æ–¹å¼å’Œä¹‹å‰çš„å§”æ‰˜æ–¹æ³•åŒæ—¶å­˜åœ¨æ—¶ï¼Œä¼šä¼˜å…ˆé€‰æ‹©å‰è€…ã€‚</p><h3 id=åŠ¨æ€ä¿®æ”¹å‚æ•°>åŠ¨æ€ä¿®æ”¹å‚æ•°</h3><p>å‰é¢ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ @SuperCall æ³¨è§£æ³¨å…¥çš„ Callable å‚æ•°æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶ï¼Œæ˜¯æ— æ³•åŠ¨æ€ä¿®æ”¹å‚æ•°çš„ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€ä¿®æ”¹å‚æ•°ï¼Œåˆ™éœ€è¦ç”¨åˆ° @Morph æ³¨è§£ä»¥åŠä¸€äº›ç»‘å®šæ“ä½œï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p>Interceptor ä¼šä½¿ç”¨ @Morph æ³¨è§£æ³¨å…¥ä¸€ä¸ª OverrideCallable å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶åé€šè¿‡è¯¥ OverrideCallable å¯¹è±¡è°ƒç”¨ç›®æ ‡æ–¹æ³•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.ByteBuddy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.dynamic.loading.ClassLoadingStrategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.MethodDelegation</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.AllArguments</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.Morph</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.RuntimeType</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.matcher.ElementMatchers</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.api.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.reflect.Method</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ByteBuddyDemo5Delegation</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MyInterceptor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@RuntimeType</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Object</span> <span class=nf>modifyParameters</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=nd>@AllArguments</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=nd>@Morph</span> <span class=n>MyCallable</span> <span class=n>zuper</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Original arguments: &#34;</span> <span class=o>+</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>toString</span><span class=o>(</span><span class=n>args</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>args</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=k>instanceof</span> <span class=n>String</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>args</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=o>((</span><span class=n>String</span><span class=o>)</span> <span class=n>args</span><span class=o>[</span><span class=n>i</span><span class=o>]).</span><span class=na>toUpperCase</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Modified arguments: &#34;</span> <span class=o>+</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>toString</span><span class=o>(</span><span class=n>args</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>Object</span> <span class=n>call</span> <span class=o>=</span> <span class=n>zuper</span><span class=o>.</span><span class=na>call</span><span class=o>(</span><span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>call</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æµ‹è¯•åŠ¨æ€ä¿®æ”¹æ–¹æ³•å‚æ•°
</span></span></span><span class=line><span class=cl><span class=cm>     * @param args
</span></span></span><span class=line><span class=cl><span class=cm>     * @throws Exception
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * `ClassLoadingStrategy` æ˜¯ Byte Buddy åº“ä¸­ç”¨äºå®šä¹‰å¦‚ä½•åŠ è½½åŠ¨æ€åˆ›å»ºæˆ–ä¿®æ”¹çš„ç±»çš„ç­–ç•¥ã€‚è¿™ä¸ªç­–ç•¥å†³å®šäº†æ–°ç”Ÿæˆçš„ç±»åº”è¯¥è¢«å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œä»¥åŠç”Ÿæˆçš„ç±»åº”è¯¥å¦‚ä½•ä¸ç°æœ‰çš„ç±»å…³è”ã€‚è¿™é‡Œæœ‰å‡ ç§ç­–ç•¥ï¼š1. `WRAPPER`ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†è¢«ä¸å…¶çˆ¶ç±»ç›¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ã€‚åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œæ–°ç”Ÿæˆçš„ç±»ä¸èƒ½è®¿é—®åˆ°æ¯”å…¶çˆ¶ç±»æ›´é«˜çº§çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ã€‚2. `WRAPPER_PERSISTENT`ï¼šè¿™ä¸ªç­–ç•¥ä¸ `WRAPPER` ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä¼šåœ¨ç±»è¢«åŠ è½½æ—¶ç”Ÿæˆä¸€ä¸ªç±»æ¸…å•ï¼ˆmanifestï¼‰ã€‚è¿™ä¸ªæ¸…å•å¯ä»¥ç”¨äºåœ¨è¿è¡Œæ—¶è·å–å…³äºç±»çš„å…ƒæ•°æ®ã€‚3. `CHILD_FIRST`ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†è¢«ä¸€ä¸ªæ–°çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™ä¸ªæ–°çš„ç±»åŠ è½½å™¨å°†å…¶çˆ¶ç±»çš„ç±»åŠ è½½å™¨ä½œä¸ºå…¶çˆ¶åŠ è½½å™¨ã€‚åœ¨è¿™ç§ç­–ç•¥ä¸‹ï¼Œæ–°ç”Ÿæˆçš„ç±»å¯ä»¥è®¿é—®åˆ°æ¯”å…¶çˆ¶ç±»æ›´é«˜çº§çš„ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ã€‚4. `CHILD_FIRST_PERSISTENT`ï¼šè¿™ä¸ªç­–ç•¥ä¸ `CHILD_FIRST` ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šåœ¨ç±»è¢«åŠ è½½æ—¶ç”Ÿæˆä¸€ä¸ªç±»æ¸…å•ã€‚5. `INJECTION`ï¼šè¿™ä¸ªç­–ç•¥è¡¨ç¤ºæ–°ç”Ÿæˆçš„ç±»å°†ç›´æ¥è¢«æ³¨å…¥åˆ°å…¶çˆ¶ç±»æ‰€åœ¨çš„ç±»åŠ è½½å™¨ã€‚è¿™éœ€è¦ç±»åŠ è½½å™¨æ”¯æŒç±»çš„åŠ¨æ€æ³¨å…¥ã€‚è¿™äº›ç­–ç•¥çš„é€‰æ‹©å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ éœ€è¦æ–°ç”Ÿæˆçš„ç±»èƒ½å¤Ÿè®¿é—®åˆ°æ›´å¤šçš„ç±»ï¼Œä½ å¯èƒ½éœ€è¦é€‰æ‹© `CHILD_FIRST` æˆ– `CHILD_FIRST_PERSISTENT` ç­–ç•¥ã€‚å¦‚æœä½ ä¸éœ€è¦è¿™æ ·çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆ `WRAPPER` æˆ– `WRAPPER_PERSISTENT` ç­–ç•¥å¯èƒ½ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>dynamicType</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>MyTargetClass</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>method</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>named</span><span class=o>(</span><span class=s>&#34;process&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=c1>// è¦ç”¨@Morphæ³¨è§£ä¹‹å‰ï¼Œéœ€è¦é€šè¿‡ Morph.Binder å‘Šè¯‰ Byte Buddy
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>// è¦æ³¨å…¥çš„å‚æ•°æ˜¯ä»€ä¹ˆç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span><span class=n>MethodDelegation</span><span class=o>.</span><span class=na>withDefaultConfiguration</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>withBinders</span><span class=o>(</span><span class=n>Morph</span><span class=o>.</span><span class=na>Binder</span><span class=o>.</span><span class=na>install</span><span class=o>(</span><span class=n>MyCallable</span><span class=o>.</span><span class=na>class</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=k>new</span> <span class=n>MyInterceptor</span><span class=o>()))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=n>ByteBuddyDemo5Delegation</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>ClassLoadingStrategy</span><span class=o>.</span><span class=na>Default</span><span class=o>.</span><span class=na>INJECTION</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>MyTargetClass</span> <span class=n>myInstance</span> <span class=o>=</span> <span class=o>(</span><span class=n>MyTargetClass</span><span class=o>)</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>().</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>queryUser</span> <span class=o>=</span> <span class=n>dynamicType</span><span class=o>.</span><span class=na>getMethod</span><span class=o>(</span><span class=s>&#34;process&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>queryUser</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>myInstance</span><span class=o>,</span> <span class=s>&#34;hello&#34;</span><span class=o>,</span> <span class=s>&#34;world&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>MyTargetClass</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>process</span><span class=o>(</span><span class=n>String</span> <span class=n>str1</span><span class=o>,</span> <span class=n>String</span> <span class=n>str2</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Processing: &#34;</span> <span class=o>+</span> <span class=n>str1</span> <span class=o>+</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=n>str2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MyCallable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=nf>call</span><span class=o>(</span><span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=æ„é€ å™¨æ–¹æ³•>æ„é€ å™¨æ–¹æ³•</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.ByteBuddy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.dynamic.DynamicType</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.MethodDelegation</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.SuperMethodCall</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.RuntimeType</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.implementation.bind.annotation.This</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>net.bytebuddy.matcher.ElementMatchers</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.itstack.UserService</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.junit.jupiter.api.Test</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ByteBuddyDemo6</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * æµ‹è¯•æ‹¦æˆªæ„é€ æ–¹æ³•
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>constructorDelegation</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DynamicType</span><span class=o>.</span><span class=na>Unloaded</span><span class=o>&lt;</span><span class=n>UserService</span><span class=o>&gt;</span> <span class=n>unloaded</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ByteBuddy</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>subclass</span><span class=o>(</span><span class=n>UserService</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>constructor</span><span class=o>(</span><span class=n>ElementMatchers</span><span class=o>.</span><span class=na>any</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>intercept</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                        <span class=c1>//åœ¨æ„é€ å™¨æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åè¿›è¡Œæ‹¦æˆª
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=n>SuperMethodCall</span><span class=o>.</span><span class=na>INSTANCE</span><span class=o>.</span><span class=na>andThen</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                                <span class=n>MethodDelegation</span><span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=k>new</span> <span class=n>MethodInterceptor4</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                        <span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>make</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>loaded</span> <span class=o>=</span> <span class=n>unloaded</span><span class=o>.</span><span class=na>load</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>()).</span><span class=na>getLoaded</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>loaded</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>class</span> <span class=nc>MethodInterceptor4</span><span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nd>@RuntimeType</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>constructorAspect</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=nd>@This</span> <span class=n>Object</span> <span class=n>target</span>
</span></span><span class=line><span class=cl>        <span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>target</span> <span class=o>+</span> <span class=s>&#34;ï¼šå®ä¾‹åŒ–åç½®æ“ä½œ&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=å¸¸ç”¨æ ¸å¿ƒapi>å¸¸ç”¨æ ¸å¿ƒAPI</h3><ol><li><code>ByteBuddy</code><ul><li>æµå¼APIæ–¹å¼çš„å…¥å£ç±»</li><li>æä¾›Subclassing/Redefining/Rebasingæ–¹å¼æ”¹å†™å­—èŠ‚ç </li><li>æ‰€æœ‰çš„æ“ä½œä¾èµ–DynamicType.Builderè¿›è¡Œ,åˆ›å»ºä¸å¯å˜çš„å¯¹è±¡</li></ul></li><li><code>ElementMatchers(ElementMatcher)</code><ul><li>æä¾›ä¸€ç³»åˆ—çš„å…ƒç´ åŒ¹é…çš„å·¥å…·ç±»(named/any/nameEndsWithç­‰ç­‰)</li><li>ElementMatcher(æä¾›å¯¹ç±»å‹ã€æ–¹æ³•ã€å­—æ®µã€æ³¨è§£è¿›è¡Œmatchesçš„æ–¹å¼,ç±»ä¼¼äºPredicate)</li><li>Junctionå¯¹å¤šä¸ªElementMatcherè¿›è¡Œäº†and/oræ“ä½œ</li></ul></li><li><code>DynamicType</code>(åŠ¨æ€ç±»å‹,æ‰€æœ‰å­—èŠ‚ç æ“ä½œçš„å¼€å§‹,éå¸¸å€¼å¾—å…³æ³¨)<ul><li>Unloaded(åŠ¨æ€åˆ›å»ºçš„å­—èŠ‚ç è¿˜æœªåŠ è½½è¿›å…¥åˆ°è™šæ‹Ÿæœº,éœ€è¦ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½)</li><li>Loaded(å·²åŠ è½½åˆ°jvmä¸­å,è§£æå‡ºClassè¡¨ç¤º)</li><li>Default(DynamicTypeçš„é»˜è®¤å®ç°,å®Œæˆç›¸å…³å®é™…æ“ä½œ)</li></ul></li><li><code>Implementation</code>(ç”¨äºæä¾›åŠ¨æ€æ–¹æ³•çš„å®ç°)<ul><li>FixedValue(æ–¹æ³•è°ƒç”¨è¿”å›å›ºå®šå€¼)</li><li>MethodDelegation(æ–¹æ³•è°ƒç”¨å§”æ‰˜,æ”¯æŒä¸¤ç§æ–¹å¼: Classçš„staticæ–¹æ³•è°ƒç”¨ã€objectçš„instance methodæ–¹æ³•è°ƒç”¨)</li></ul></li><li><code>Builder</code>(ç”¨äºåˆ›å»ºDynamicType,ç›¸å…³æ¥å£ä»¥åŠå®ç°åç»­å¾…è¯¦è§£)<ul><li>MethodDefinition</li><li>FieldDefinition</li><li>AbstractBase</li></ul></li></ol><h2 id=é“¾æ¥>é“¾æ¥</h2><p><a class=link href=https://bytebuddy.net/#/tutorial-cn target=_blank rel=noopener>https://bytebuddy.net/#/tutorial-cn</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/bytebuddy/>bytebuddy</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/ii-bytebuddy%E5%85%A5%E9%97%A8%E7%AC%94%E8%AE%B02/><div class=article-details><h2 class=article-title>II: ByteBuddyå…¥é—¨ç¬”è®°2</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 importzhhçš„å°ç ´ç«™</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>